# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ - –ü–∞—Ä—Å–µ—Ä Kwork

## üìñ –û–±—â–∏–π –æ–±–∑–æ—Ä

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø–∞—Ä—Å–µ—Ä –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã Kwork.ru, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ FastAPI —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Playwright –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ HTTP-–∫–ª–∏–µ–Ω—Ç–æ–º –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
app/
‚îú‚îÄ‚îÄ api/v1/              # API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ auth.py          # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ accounts.py      # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏ Kwork
‚îÇ   ‚îú‚îÄ‚îÄ orders.py        # API –¥–ª—è –∑–∞–∫–∞–∑–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ chat.py          # API –¥–ª—è —á–∞—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ gigs.py          # API –¥–ª—è –∫–≤–æ—Ä–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ files.py         # –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ quark.py         # API –¥–ª—è Quark
‚îú‚îÄ‚îÄ core/                # –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ config.py        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database.py      # –†–∞–±–æ—Ç–∞ —Å SQLite
‚îÇ   ‚îú‚îÄ‚îÄ security.py      # –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ JWT
‚îÇ   ‚îú‚îÄ‚îÄ rate_limiter.py  # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ forbidden_routes.py # –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
‚îú‚îÄ‚îÄ services/            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ kwork_client.py          # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∏–µ–Ω—Ç –ø–∞—Ä—Å–µ—Ä–∞
‚îÇ   ‚îî‚îÄ‚îÄ kwork_playwright_auth.py # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
‚îú‚îÄ‚îÄ models/              # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ schemas.py       # Pydantic –º–æ–¥–µ–ª–∏
‚îî‚îÄ‚îÄ utils/               # –£—Ç–∏–ª–∏—Ç—ã
    ‚îî‚îÄ‚îÄ file_handler.py  # –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏
```

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞

### 1. KworkClient (`app/services/kwork_client.py`)

**–û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ Kwork.ru**

#### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:

```python
# –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
await client.authenticate_with_playwright(show_browser=False, force_new_auth=False)

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
orders = await client.get_orders(page=1, limit=20, filters=None)

# –ü–æ–ª—É—á–µ–Ω–∏–µ –º–æ–∏—Ö –∫–≤–æ—Ä–∫–æ–≤
gigs = await client.get_my_gigs()

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∞–∫–∫–∞—É–Ω—Ç–µ
account_info = await client.get_account_info()

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —á–∞—Ç–æ–≤
chats = await client.get_chat_list()

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞
messages = await client.get_chat_messages(dialog_id="username")

# –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
await client.send_message(dialog_id="username", message="text")
```

#### –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã:

- **HTTP-–∫–ª–∏–µ–Ω—Ç**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `httpx` –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
- **Rate Limiting**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ü–∞—Ä—Å–∏–Ω–≥ HTML**: BeautifulSoup –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- **–°–µ—Å—Å–∏–∏**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫—É–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

### 2. KworkPlaywrightAuth (`app/services/kwork_playwright_auth.py`)

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä**

#### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º**: –í–≤–æ–¥ –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ
- **–†—É—á–Ω–æ–π —Ä–µ–∂–∏–º**: –û—Ç–∫—Ä—ã—Ç–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫—É–∫–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –≤—Ö–æ–¥–∞

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```python
from app.services.kwork_playwright_auth import authenticate_kwork_account

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
cookies = await authenticate_kwork_account(
    login="your_email@example.com",
    password="your_password",
    show_browser=False,
    force_new_auth=False
)

# –†—É—á–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–æ—Ç–∫—Ä–æ–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä)
cookies = await authenticate_kwork_account(
    login="your_email@example.com", 
    password="your_password",
    show_browser=True,
    force_new_auth=True
)
```

### 3. Rate Limiter (`app/core/rate_limiter.py`)

**–°–∏—Å—Ç–µ–º–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤**

#### –õ–∏–º–∏—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è: 1 —Ä–∞–∑ –≤ 24 —á–∞—Å–∞
- –û–±—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã: 60 –≤ –º–∏–Ω—É—Ç—É
- –û—Ç–∫–ª–∏–∫–∏ –Ω–∞ –∑–∞–∫–∞–∑—ã: 10 –≤ —á–∞—Å
- –°–æ–æ–±—â–µ–Ω–∏—è: 30 –≤ —á–∞—Å

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `config.py`:

```python
MIN_DELAY = 1.0  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
MAX_DELAY = 3.0  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
MAX_REQUESTS_PER_MINUTE = 60
```

## üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥

### 1. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

```mermaid
graph TD
    A[–ó–∞–ø—É—Å–∫ Playwright] --> B[–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ /login]
    B --> C{–ï—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∫—É–∫–∏?}
    C -->|–î–∞| D[–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏]
    C -->|–ù–µ—Ç| E[–í–≤–æ–¥ –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è]
    D -->|–í–∞–ª–∏–¥–Ω—ã| F[–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—É–∫–∏]
    D -->|–ù–µ–≤–∞–ª–∏–¥–Ω—ã| E
    E --> G[–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã]
    G --> H[–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫—É–∫–∏]
    H --> F
    F --> I[–ü–µ—Ä–µ–¥–∞—á–∞ –∫—É–∫–∏ –≤ httpx]
```

### 2. –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–∫–∞–∑–æ–≤

**Endpoint**: `GET https://kwork.ru/` (–≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏)

**–ü–∞—Ä—Å–∏–Ω–≥ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑**:
- HTML —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ –∑–∞–∫–∞–∑–æ–≤
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ: ID, –∑–∞–≥–æ–ª–æ–≤–æ–∫, –æ–ø–∏—Å–∞–Ω–∏–µ, —Ü–µ–Ω–∞, –∫–∞—Ç–µ–≥–æ—Ä–∏—è
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü

**–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö**:
```json
{
  "success": true,
  "data": [
    {
      "id": "12345",
      "title": "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–∞–π—Ç–∞",
      "description": "–ù—É–∂–µ–Ω —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–∞–π—Ç...",
      "price": 50000,
      "category": "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ IT",
      "url": "https://kwork.ru/project/12345",
      "published_at": "1 —á–∞—Å –Ω–∞–∑–∞–¥",
      "responses_count": 5
    }
  ],
  "page": 1,
  "total": 100,
  "has_next": true
}
```

### 3. –ü–∞—Ä—Å–∏–Ω–≥ –∫–≤–æ—Ä–∫–æ–≤

**Endpoint**: `GET https://kwork.ru/manage_kworks`

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –î–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ JavaScript –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `stateData`
- –°–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–≤–æ—Ä–∫–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –ø—Ä–æ—Å–º–æ—Ç—Ä—ã, –∑–∞–∫–∞–∑—ã, —Ä–µ–π—Ç–∏–Ω–≥

### 4. –ü–∞—Ä—Å–∏–Ω–≥ —á–∞—Ç–æ–≤

**Endpoint**: `GET https://kwork.ru/inbox`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
- –°–ø–∏—Å–æ–∫ –¥–∏–∞–ª–æ–≥–æ–≤ —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏
- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

–ü–∞—Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Fernet:

```python
from app.core.security import encrypt_password, decrypt_password

# –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
encrypted = encrypt_password("user_password")

# –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏  
password = decrypt_password(encrypted)
```

### –ö–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `encryption.key`:

```python
from cryptography.fernet import Fernet
key = Fernet.generate_key()
```

### JWT —Ç–æ–∫–µ–Ω—ã

–î–ª—è API –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è JWT —Ç–æ–∫–µ–Ω—ã:

```python
from app.core.security import create_access_token, verify_token

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
token = create_access_token(data={"sub": str(user_id)})

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
payload = verify_token(token)
```

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã
users (id, username, email, hashed_password, is_active, created_at)

-- –ê–∫–∫–∞—É–Ω—Ç—ã Kwork
kwork_accounts (id, user_id, login, encrypted_password, account_name, 
                session_data, is_active, last_login, created_at)

-- –õ–æ–≥–∏ –¥–µ–π—Å—Ç–≤–∏–π
action_logs (id, user_id, account_id, action_type, description, 
            ip_address, user_agent, timestamp)

-- –°–µ—Å—Å–∏–∏
sessions (id, user_id, account_id, session_token, expires_at, 
          is_active, created_at)

-- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
temp_files (id, user_id, filename, filepath, file_size, 
           content_type, created_at, expires_at)
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env`
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
```bash
KWORK_TEST_USERNAME=your_email@example.com
KWORK_TEST_PASSWORD=your_password
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:

```bash
# –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ—Å—Ç –ø–∞—Ä—Å–µ—Ä–∞
python test_kwork_parser.py
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤:

- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Playwright
- **–ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–∫–∞–∑–æ–≤**: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏ —Ä–∞–∑–±–æ—Ä —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤
- **–ü–∞—Ä—Å–∏–Ω–≥ –∫–≤–æ—Ä–∫–æ–≤**: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–≤–æ–∏—Ö —É—Å–ª—É–≥
- **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–∫–∫–∞—É–Ω—Ç–µ**: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üöÄ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

### –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫:

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d --build

# –¢–æ–ª—å–∫–æ API –∏ Redis
docker-compose up app redis -d --build
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:

- **API**: http://localhost:8000
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: http://localhost:8000/docs
- **Redis**: localhost:6379
- **Nginx**: http://localhost (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)

## üìù API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:
```
POST /api/v1/auth/register    # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
POST /api/v1/auth/login       # –í—Ö–æ–¥
GET  /api/v1/auth/me          # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏:
```
POST /api/v1/accounts/                    # –î–æ–±–∞–≤–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç Kwork
GET  /api/v1/accounts/                    # –°–ø–∏—Å–æ–∫ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
POST /api/v1/accounts/{id}/switch         # –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç
POST /api/v1/accounts/{id}/test-connection # –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```

### –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö:
```
GET  /api/v1/orders/          # –ü–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑—ã
GET  /api/v1/gigs/            # –ü–æ–ª—É—á–∏—Ç—å –∫–≤–æ—Ä–∫–∏
GET  /api/v1/chat/            # –ü–æ–ª—É—á–∏—Ç—å —á–∞—Ç—ã
POST /api/v1/chat/{id}/send   # –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
```

## üõ†Ô∏è –î–æ—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–µ—Ç–æ–¥–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞:

1. **–î–æ–±–∞–≤—å—Ç–µ –º–µ—Ç–æ–¥ –≤ KworkClient**:
```python
async def get_new_data(self) -> Dict[str, Any]:
    if not self.is_authenticated:
        return {"success": False, "error": "Not authenticated"}
    
    try:
        response = await self._make_request("GET", "/new-endpoint")
        # –õ–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞
        return {"success": True, "data": parsed_data}
    except Exception as e:
        return {"success": False, "error": str(e)}
```

2. **–°–æ–∑–¥–∞–π—Ç–µ API endpoint**:
```python
# –í app/api/v1/new_endpoint.py
@router.get("/")
async def get_new_data(current_user = Depends(get_current_user)):
    client = await get_active_client()
    return await client.get_new_data()
```

3. **–î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã**:
```python
async def test_new_data_parsing():
    async with KworkClient("test", username, password) as client:
        await client.authenticate_with_playwright()
        result = await client.get_new_data()
        assert result["success"] == True
```

### –£–ª—É—á—à–µ–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞:

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤—ã—Ö —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤:
```python
# –í –º–µ—Ç–æ–¥–∞—Ö –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
selectors = [
    'div.new-selector',
    'article.updated-class',
    # –†–µ–∑–µ—Ä–≤–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
    'div[data-id]',
    'div:has(> h2)'
]
```

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ AJAX –∑–∞–ø—Ä–æ—Å–æ–≤:
```python
# –î–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
async def get_dynamic_data(self, endpoint: str):
    response = await self._make_request(
        "GET", 
        endpoint,
        headers={"X-Requested-With": "XMLHttpRequest"}
    )
    return response.json()
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:

```python
# –í KworkClient
async def authenticate_with_api_key(self, api_key: str) -> bool:
    # –õ–æ–≥–∏–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ API –∫–ª—é—á
    pass

async def authenticate_with_oauth(self, oauth_token: str) -> bool:
    # –õ–æ–≥–∏–∫–∞ OAuth –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
    pass
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### Rate Limiting:
- **–í—Å–µ–≥–¥–∞ —Å–æ–±–ª—é–¥–∞–π—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è** - –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `await asyncio.sleep()` –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –æ—à–∏–±–æ–∫ 429 (Too Many Requests)

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
```python
try:
    result = await client.get_data()
except httpx.TimeoutException:
    # –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞
    pass
except httpx.HTTPStatusError as e:
    # HTTP –æ—à–∏–±–∫–∞ (4xx, 5xx)
    if e.response.status_code == 429:
        # Rate limit exceeded
        await asyncio.sleep(60)
except Exception as e:
    # –û–±—â–∞—è –æ—à–∏–±–∫–∞
    logger.error(f"Unexpected error: {e}")
```

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Å–∞–π—Ç–∞:
- **–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã** - —Å–∞–π—Ç –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è
- –î–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ö—É–∫–∏ –∏ —Å–µ—Å—Å–∏–∏:
- –ö—É–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `uploads/cookies/`
- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 7 –¥–Ω–µ–π
- –ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å–µ—Å—Å–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:
```python
import logging

# –í –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
logger.info("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ")
logger.warning("–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ") 
logger.error("–û—à–∏–±–∫–∞")
logger.debug("–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è")
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–æ–≤:
- –í—Å–µ HTTP –∑–∞–ø—Ä–æ—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –æ—à–∏–±–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ª–æ–≥–æ–≤:
```sql
-- –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ action_logs
SELECT * FROM action_logs 
WHERE action_type = 'auth_failed' 
ORDER BY timestamp DESC;
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
```bash
pip install -r requirements.txt --upgrade
playwright install chromium
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: `kwork_hub.db`
- –ö—É–∫–∏: `uploads/cookies/`
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: `.env`

### –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- –í–µ–¥–∏—Ç–µ CHANGELOG.md
- –¢–µ–≥–∏—Ä—É–π—Ç–µ —Ä–µ–ª–∏–∑—ã –≤ Git

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å kwork.ru
4. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∞–∫–∫–∞—É–Ω—Ç –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω

**–£–¥–∞—á–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏! üöÄ**