spring.application.name=core-crm-messaging-service

# Server Configuration
server.port=8080

# Database Configuration (Messaging System)
spring.datasource.url=${DATABASE_URL:jdbc:postgresql://localhost:5432/crm_messaging_dev}
spring.datasource.username=${DATABASE_USERNAME:crm_user}
spring.datasource.password=${DATABASE_PASSWORD:crm_password}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA/Hibernate Configuration
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect

# Redis Configuration
spring.data.redis.url=${REDIS_URL:redis://localhost:6379}
spring.data.redis.timeout=2000ms
spring.data.redis.lettuce.pool.max-active=8
spring.data.redis.lettuce.pool.max-wait=-1ms
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=0

# JWT Configuration
jwt.secret=${JWT_SECRET:dev_jwt_secret_key_for_messaging_system_at_least_32_chars}
jwt.access-token-expiration=${JWT_ACCESS_TOKEN_EXPIRATION:3600000}
jwt.refresh-token-expiration=${JWT_REFRESH_TOKEN_EXPIRATION:604800000}
jwt.algorithm=HS256

# Messaging Configuration
messaging.notification-service.url=${NOTIFICATION_SERVICE_URL:http://localhost:3003}
messaging.notification-service.enabled=true

# ✅ NEW - Telegram Configuration
messaging.telegram.enabled=${TELEGRAM_ENABLED:true}
messaging.telegram.webhook-base-url=${TELEGRAM_WEBHOOK_BASE_URL:http://localhost:8080/api/v1/webhooks/telegram}
messaging.telegram.max-file-size=${TELEGRAM_MAX_FILE_SIZE:52428800}
messaging.telegram.api-base-url=${TELEGRAM_API_BASE_URL:https://api.telegram.org}

# ✅ NEW - WhatsApp Configuration  
messaging.whatsapp.enabled=${WHATSAPP_ENABLED:true}
messaging.whatsapp.provider=${WHATSAPP_PROVIDER:twilio}
messaging.whatsapp.webhook-url=${WHATSAPP_WEBHOOK_URL:http://localhost:8080/api/v1/webhooks/whatsapp}
messaging.whatsapp.verify-token=${WHATSAPP_VERIFY_TOKEN:your-verify-token-here}
messaging.whatsapp.api-version=${WHATSAPP_API_VERSION:v17.0}
messaging.whatsapp.max-file-size=${WHATSAPP_MAX_FILE_SIZE:16777216}

# ✅ NEW - WhatsApp Twilio Configuration (if using Twilio)
messaging.whatsapp.twilio.account-sid=${TWILIO_ACCOUNT_SID:}
messaging.whatsapp.twilio.auth-token=${TWILIO_AUTH_TOKEN:}
messaging.whatsapp.twilio.from-number=${TWILIO_WHATSAPP_FROM:}

# ✅ NEW - WhatsApp Business API Configuration (if using direct API)
messaging.whatsapp.business.access-token=${WHATSAPP_ACCESS_TOKEN:}
messaging.whatsapp.business.phone-number-id=${WHATSAPP_PHONE_NUMBER_ID:}
messaging.whatsapp.business.business-account-id=${WHATSAPP_BUSINESS_ACCOUNT_ID:}
messaging.whatsapp.business.api-base-url=${WHATSAPP_API_BASE_URL:https://graph.facebook.com}

# ✅ NEW - Platform-specific settings
messaging.platforms.auto-create-channels=${PLATFORMS_AUTO_CREATE_CHANNELS:true}
messaging.platforms.default-manager-assignment=${PLATFORMS_DEFAULT_MANAGER_ASSIGNMENT:round-robin}
messaging.platforms.message-retention-days=${PLATFORMS_MESSAGE_RETENTION_DAYS:365}

# Notification Configuration
notification.email.enabled=true
notification.email.provider=stub
notification.email.from-email=noreply@crm.com
notification.email.from-name=CRM System
notification.sms.enabled=true
notification.sms.provider=stub

# ✅ NEW - File Storage Configuration (for Telegram/WhatsApp media)
messaging.storage.provider=${STORAGE_PROVIDER:local}
messaging.storage.local.base-path=${STORAGE_LOCAL_PATH:./uploads/messaging}
messaging.storage.s3.bucket-name=${S3_BUCKET_NAME:crm-messaging-files}
messaging.storage.s3.region=${S3_REGION:us-east-1}
messaging.storage.s3.access-key=${S3_ACCESS_KEY:}
messaging.storage.s3.secret-key=${S3_SECRET_KEY:}

# ✅ NEW - Media Processing Configuration
messaging.media.image.max-width=${MEDIA_IMAGE_MAX_WIDTH:1920}
messaging.media.image.max-height=${MEDIA_IMAGE_MAX_HEIGHT:1080}
messaging.media.image.quality=${MEDIA_IMAGE_QUALITY:85}
messaging.media.thumbnail.width=${MEDIA_THUMBNAIL_WIDTH:320}
messaging.media.thumbnail.height=${MEDIA_THUMBNAIL_HEIGHT:240}

# ✅ NEW - Rate Limiting Configuration
messaging.rate-limit.enabled=${RATE_LIMIT_ENABLED:true}
messaging.rate-limit.telegram.messages-per-second=${TELEGRAM_RATE_LIMIT:30}
messaging.rate-limit.whatsapp.messages-per-second=${WHATSAPP_RATE_LIMIT:80}
messaging.rate-limit.window-size-seconds=${RATE_LIMIT_WINDOW:60}

# ✅ NEW - Webhook Security Configuration
messaging.webhook.telegram.secret-token=${TELEGRAM_WEBHOOK_SECRET:}
messaging.webhook.whatsapp.verify-token=${WHATSAPP_WEBHOOK_VERIFY_TOKEN:your-verify-token}
messaging.webhook.ip-whitelist=${WEBHOOK_IP_WHITELIST:}
messaging.webhook.max-payload-size=${WEBHOOK_MAX_PAYLOAD_SIZE:10485760}

# ✅ NEW - Message Processing Configuration
messaging.processing.async.enabled=${ASYNC_PROCESSING_ENABLED:true}
messaging.processing.batch-size=${PROCESSING_BATCH_SIZE:100}
messaging.processing.retry.max-attempts=${PROCESSING_MAX_RETRIES:3}
messaging.processing.retry.delay-seconds=${PROCESSING_RETRY_DELAY:5}

# ✅ NEW - AI/ML Integration Configuration (for sentiment analysis)
messaging.ai.enabled=${AI_ENABLED:false}
messaging.ai.provider=${AI_PROVIDER:openai}
messaging.ai.openai.api-key=${OPENAI_API_KEY:}
messaging.ai.openai.model=${OPENAI_MODEL:gpt-3.5-turbo}
messaging.ai.sentiment.enabled=${AI_SENTIMENT_ENABLED:false}
messaging.ai.language-detection.enabled=${AI_LANGUAGE_DETECTION_ENABLED:false}

# ✅ NEW - Channel Management Configuration
messaging.channels.auto-activation=${CHANNELS_AUTO_ACTIVATION:true}
messaging.channels.health-check-interval=${CHANNELS_HEALTH_CHECK_INTERVAL:300}
messaging.channels.max-inactive-hours=${CHANNELS_MAX_INACTIVE_HOURS:24}

# Logging Configuration
logging.level.com.backend=DEBUG
logging.level.com.backend.core.messaging.platforms=INFO
logging.level.org.springframework.security=INFO
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# ✅ NEW - Platform-specific Logging
logging.level.com.backend.core.messaging.platforms.telegram=DEBUG
logging.level.com.backend.core.messaging.platforms.whatsapp=DEBUG

# Management Endpoints (for health checks)
management.endpoints.web.exposure.include=health,info,metrics,telegram,whatsapp
management.endpoint.health.show-details=always

# ✅ NEW - Custom Health Indicators
management.health.telegram.enabled=${TELEGRAM_HEALTH_CHECK_ENABLED:true}
management.health.whatsapp.enabled=${WHATSAPP_HEALTH_CHECK_ENABLED:true}
management.health.messaging.enabled=true

# Security Configuration
spring.security.require-ssl=false

# ✅ NEW - CORS Configuration for Webhook Endpoints
messaging.cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:3001}
messaging.cors.allowed-methods=${CORS_ALLOWED_METHODS:GET,POST,PUT,DELETE,OPTIONS}
messaging.cors.allowed-headers=${CORS_ALLOWED_HEADERS:*}
messaging.cors.exposed-headers=${CORS_EXPOSED_HEADERS:}
messaging.cors.allow-credentials=${CORS_ALLOW_CREDENTIALS:true}
messaging.cors.max-age=${CORS_MAX_AGE:3600}

# ✅ NEW - Monitoring and Metrics
messaging.metrics.enabled=${METRICS_ENABLED:true}
messaging.metrics.export.prometheus.enabled=${PROMETHEUS_METRICS_ENABLED:false}
messaging.metrics.export.influx.enabled=${INFLUX_METRICS_ENABLED:false}

# ✅ NEW - Background Job Configuration
messaging.jobs.cleanup.enabled=${CLEANUP_JOBS_ENABLED:true}
messaging.jobs.cleanup.schedule=${CLEANUP_SCHEDULE:0 2 * * *}
messaging.jobs.cleanup.retention-days=${CLEANUP_RETENTION_DAYS:90}
messaging.jobs.stats.enabled=${STATS_JOBS_ENABLED:true}
messaging.jobs.stats.schedule=${STATS_SCHEDULE:0 0 * * *}